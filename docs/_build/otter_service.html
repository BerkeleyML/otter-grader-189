

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Grading on a Deployed Service &#8212; Otter-Grader  documentation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link href="_static/css/index.css" rel="stylesheet">
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="PDF Generation and Filtering" href="pdfs.html" />
    <link rel="prev" title="Grading on Gradescope" href="otter_generate.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">

<a class="navbar-brand" href="index_beta.html">
  <img src="_static/otter-logo-smaller.png" class="logo" alt="logo">
</a>

<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>

<div id="navbar-menu" class="collapse navbar-collapse">
  <ul id="navbar-main-elements" class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="index_beta.html">Home</a>
    </li>
    
    
    <li class="nav-item ">
        <a class="nav-link" href="tutorial.html">Tutorial</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="test_files.html">Test Files</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="otter_assign.html">Distributing Assignments</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="otter_check.html">Student Usage</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="otter_grade.html">Grading Locally</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="otter_generate.html">Grading on Gradescope</a>
    </li>
    
    <li class="nav-item active">
        <a class="nav-link" href="">Grading on a Deployed Service</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="pdfs.html">PDF Generation and Filtering</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="seeding.html">Intercell Seeding</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="changelog.html">Changelog</a>
    </li>
    
    
  </ul>
  <ul class="navbar-nav ml-auto">
    
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/ucbds-infra/otter-grader" target="_blank" rel="noopener">
          <span><i class="fab fa-github-square"></i></span>
        </a>
      </li>
    
    
  </ul>
</div>
    </nav>
    

    <div class="container-fluid">
      <div class="row">
          
          <div class="col-12 col-md-3 col-xl-2 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
      
      
      
      
      
      
        
      
      
      
      
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              


<div class="tocsection onthispage"><i class="fas fa-list"></i> On this page</div>
<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#configuration-repo" class="nav-link">Configuration Repo</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#the-configuration-file" class="nav-link">The Configuration File</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#other-files" class="nav-link">Other Files</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#building-the-images" class="nav-link">Building the Images</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#otter-service-reference" class="nav-link">Otter Service Reference</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#otter-service-build" class="nav-link">otter service build</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h4">
            <a href="#Positional Arguments" class="nav-link">Positional Arguments</a>
        </li>
    
        <li class="nav-item toc-entry toc-h4">
            <a href="#Named Arguments" class="nav-link">Named Arguments</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#otter-service-start" class="nav-link">otter service start</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>

              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
              
              <div>
                
  <div class="section" id="grading-on-a-deployed-service">
<h1>Grading on a Deployed Service<a class="headerlink" href="#grading-on-a-deployed-service" title="Permalink to this headline">¶</a></h1>
<p>Otter Service is a deployable grading server that students can send submissions to from in the notebook and which will grade submissions based on predefined tests. It is a service packaged with Otter but has additional requirements that are not necessary for running Otter without Otter Service. Otter Service is a tornado server that accepts requests with student submissions, writes the submission to disk, grades them, and saves the grade breakdowns in a Postgres database. This page details how to configure an already-deployed Otter Service instance, and is agnostic of deployment type. For more information on deploying an Otter Service instance, see <a class="reference external" href="#">here</a>.</p>
<div class="section" id="configuration-repo">
<h2>Configuration Repo<a class="headerlink" href="#configuration-repo" title="Permalink to this headline">¶</a></h2>
<p>Otter Service is configured to grade assignments through a repository structure. While maintaing a git repo of assignment configurations is not required, it certainly makes editing and updated your assignments easier. Any directory that has the structure described here will do to set up assignments on an Otter Service deployments. If you are grading multiple classes on an Otter Service deployment, you must have one assignments repo for <strong>each</strong> class.</p>
<p>The first and most important file required is the <code class="docutils literal notranslate"><span class="pre">conf.yml</span></code> file, at the root of the repo. This file will define some important configurations and provide paths to the necessary files for each assignment. While the following structure is not required, we recommend something like it to keep a logical structure to the repo.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span> <span class="n">data</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">assignments</span>
    <span class="o">|</span> <span class="o">-</span> <span class="n">conf</span><span class="o">.</span><span class="n">yml</span>
    <span class="o">|</span> <span class="o">-</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
    <span class="o">|</span> <span class="n">hw</span>
        <span class="o">|</span> <span class="n">hw01</span>
            <span class="o">|</span> <span class="o">-</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
            <span class="o">|</span> <span class="n">test</span>
                <span class="o">|</span> <span class="o">-</span> <span class="n">q0</span><span class="o">.</span><span class="n">py</span>
                <span class="o">|</span> <span class="o">-</span> <span class="n">q1</span><span class="o">.</span><span class="n">py</span>
                <span class="o">...</span>
        <span class="o">|</span> <span class="n">hw02</span>
        <span class="o">...</span>
    <span class="o">|</span> <span class="n">proj</span>
        <span class="o">|</span> <span class="n">proj01</span>
        <span class="o">...</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="the-configuration-file">
<h3>The Configuration File<a class="headerlink" href="#the-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">conf.yml</span></code> file is a YAML-formatted file that defines the necessary configurations and paths to set up assignments on an Otter Service deployment. It has the following structure:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">class_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Data 8</span>      <span class="c1"># the name of the course</span>
<span class="nt">class_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">data8x</span>        <span class="c1"># a **unique** ID for the course</span>
<span class="nt">requirements</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">requirements.txt</span>      <span class="c1"># Path to a **global** reuquirements file</span>
<span class="nt">assignments</span><span class="p">:</span>                        <span class="c1"># list of assignments</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Project 2</span>               <span class="c1"># assignment name</span>
      <span class="nt">assignment_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">proj02</span>         <span class="c1"># assignment ID, unique among all assignments in this config</span>
      <span class="nt">tests_path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">proj/proj02/tests</span>                     <span class="c1"># path to directory of tests for this assignment</span>
      <span class="nt">requirements</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">proj/proj02/requirements.txt</span>        <span class="c1"># path to requirements specific to **this** assignment</span>
      <span class="nt">seed</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">42</span>                      <span class="c1"># random seed for intercell seeding</span>
      <span class="nt">files</span><span class="p">:</span>                        <span class="c1"># list of files needed by the autograder, e.g. data files</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">proj/proj02/frontiers1.csv</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">proj/proj02/frontiers2.csv</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">proj/proj02/players.py</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">class_id</span></code> must be unique among <strong>all</strong> classes being run on the Otter Service instance, whereas the <code class="docutils literal notranslate"><span class="pre">assignment_id</span></code>s must be unique only within a specific class. Also note that there are two requirements files: a global requirements file that contains requirements not <a class="reference external" href="otter_grade.html#requirements">already in the Docker image</a> to be installed on <strong>all</strong> assignment images in this config, and an assignment-specific requirements file to be installed <strong>only</strong> in the image for that assignment. Also note that all paths are relative to the root of the assignments repo.</p>
</div>
<div class="section" id="other-files">
<h3>Other Files<a class="headerlink" href="#other-files" title="Permalink to this headline">¶</a></h3>
<p>Other files can be included basically anywhere as long as its a subdirectory of the assignments repo, as long as their paths are specified in the <code class="docutils literal notranslate"><span class="pre">conf.yml</span></code> file. The assignments repo should contain any necessary requirements files, all test files, and any support files needed to execute the notebooks (e.g. data files, Python scripts).</p>
</div>
</div>
<div class="section" id="building-the-images">
<h2>Building the Images<a class="headerlink" href="#building-the-images" title="Permalink to this headline">¶</a></h2>
<p>Once you have cloned your assignments repo onto your Otter Service deployment, use the command <code class="docutils literal notranslate"><span class="pre">otter</span> <span class="pre">service</span> <span class="pre">build</span></code> to add assignments to the database and create their Docker images. Note that it is often necessary to run <code class="docutils literal notranslate"><span class="pre">otter</span> <span class="pre">service</span> <span class="pre">build</span></code> with <code class="docutils literal notranslate"><span class="pre">sudo</span></code> so that you have the necessary permissions; in this section, assume that we have prepended each command with <code class="docutils literal notranslate"><span class="pre">sudo</span></code>.</p>
<p>The builder takes one positional argument that corresponds to the path to the assignments repo; this is assumed to be <code class="docutils literal notranslate"><span class="pre">./</span></code> (i.e. it is assumed to be the working directory). It also has four arguments corresponding to Posgres connection information (the host, port, username, and password which default to <code class="docutils literal notranslate"><span class="pre">localhost</span></code>, <code class="docutils literal notranslate"><span class="pre">5432</span></code>, <code class="docutils literal notranslate"><span class="pre">root</span></code>, and <code class="docutils literal notranslate"><span class="pre">root</span></code>, resp.), an optional <code class="docutils literal notranslate"><span class="pre">--image</span></code> flag to change out the base image for the Docker images (defaults to <code class="docutils literal notranslate"><span class="pre">ucbdsinfra/otter-grader</span></code>), and quiet <code class="docutils literal notranslate"><span class="pre">-q</span></code> flag to stop Docker from printing to the console on building the images.</p>
<p>From the root of the assignments repo, building couldn’t be simpler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">otter</span> <span class="n">service</span> <span class="n">build</span>
</pre></div>
</div>
<p>This command will add all assignments in the <code class="docutils literal notranslate"><span class="pre">conf.yml</span></code> to the database and create the needed Docker images to grade submissions.</p>
</div>
<div class="section" id="otter-service-reference">
<h2>Otter Service Reference<a class="headerlink" href="#otter-service-reference" title="Permalink to this headline">¶</a></h2>
<div class="section" id="otter-service-build">
<h3><code class="docutils literal notranslate"><span class="pre">otter</span> <span class="pre">service</span> <span class="pre">build</span></code><a class="headerlink" href="#otter-service-build" title="Permalink to this headline">¶</a></h3>
<p><p>Build images for an otter-service instance</p>
</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">otter</span> <span class="n">service</span> <span class="n">build</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">db</span><span class="o">-</span><span class="n">host</span> <span class="n">DB_HOST</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">db</span><span class="o">-</span><span class="n">port</span> <span class="n">DB_PORT</span><span class="p">]</span>
                           <span class="p">[</span><span class="o">-</span><span class="n">u</span> <span class="n">DB_USER</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">p</span> <span class="n">DB_PASS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">image</span> <span class="n">IMAGE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">q</span><span class="p">]</span>
                           <span class="n">repo_path</span>
</pre></div>
</div>
<div class="section" id="Positional Arguments">
<h4>Positional Arguments<a class="headerlink" href="#Positional Arguments" title="Permalink to this headline">¶</a></h4>
<dl class="option-list">
<dt><kbd>repo_path</kbd></dt>
<dd><p>Path to assignments repo root</p>
<p>Default: “.”</p>
</dd>
</dl>
</div>
<div class="section" id="Named Arguments">
<h4>Named Arguments<a class="headerlink" href="#Named Arguments" title="Permalink to this headline">¶</a></h4>
<dl class="option-list">
<dt><kbd>--db-host</kbd></dt>
<dd><p>Postgres database host</p>
<p>Default: “localhost”</p>
</dd>
<dt><kbd>--db-port</kbd></dt>
<dd><p>Postgres database port</p>
<p>Default: 5432</p>
</dd>
<dt><kbd>-u, --db-user</kbd></dt>
<dd><p>Postgres database user</p>
<p>Default: “root”</p>
</dd>
<dt><kbd>-p, --db-pass</kbd></dt>
<dd><p>Postgres database password</p>
<p>Default: “root”</p>
</dd>
<dt><kbd>--image</kbd></dt>
<dd><p>Based image for grading containers</p>
<p>Default: “ucbdsinfra/otter-grader”</p>
</dd>
<dt><kbd>-q, --quiet</kbd></dt>
<dd><p>Build images without writing Docker messages to stdout</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="otter-service-start">
<h3><code class="docutils literal notranslate"><span class="pre">otter</span> <span class="pre">service</span> <span class="pre">start</span></code><a class="headerlink" href="#otter-service-start" title="Permalink to this headline">¶</a></h3>
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="otter_generate.html" title="previous page">Grading on Gradescope</a>
    <a class='right-next' id="next-link" href="pdfs.html" title="next page">PDF Generation and Filtering</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="_static/js/index.js"></script>
    <footer class="footer">
  <div class="container">
    <p>
          &copy; Copyright 2020, UC Berkeley Division of Data Science and Information.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>